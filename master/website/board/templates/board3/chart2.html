{% extends "base.html" %}
{% load static %}

{% block scripts %}
{{ block.super }}
<script>

</script>
{% endblock %}

{% block body %}

{% include "navbar.html" %}
{% include "sidebar.html" %}

<!--main content start-->
<section id="main-content">
    <section class="wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="page-header"><i class="icon_piechart"></i> Chart</h3>
            </div>
        </div>
        <div class="row">
            <!-- chart morris start -->
            <div class="col-lg-12">
                <section class="panel">
                    <header class="panel-heading">
                        <h3>Chart 2</h3>
                    </header>
                    <div class="panel-body">
                        <div class="tab-pane" id="chartjs">
                            <div class="row">
                                <!-- Line -->
                                <div class="col-lg-6">
                                    <section class="panel">
                                        <header class="panel-heading">
                                            1.
                                        </header>
                                        <div class="panel-body text-center">
                                            <canvas id="year_chart" height="300" width="450"></canvas>
                                        </div>
                                    </section>
                                </div>
                                <!-- Bar -->
                                <div class="col-lg-6">
                                    <section class="panel">
                                        <header class="panel-heading">
                                            2.
                                        </header>
                                        <div class="panel-body text-center">
                                            <canvas id="month_chart" height="300" width="500"></canvas>
                                        </div>
                                    </section>
                                </div>
                                <div class="table-responsive">
                                    <table class="table" width="100%">
                                        <tr>
                                            <th></th>
                                            <th>전년</th>
                                            <th>당년</th>
                                            <th>성장률</th>
                                            <th></th>
                                            <th>전월</th>
                                            <th>당월</th>
                                            <th>성장률</th>
                                        </tr>
                                        <tr>
                                            <th>매출액</th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        <tr>
                                            <th>고정비</th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        <tr>
                                            <th>매출액</th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            <!-- chart morris start -->
        </div>
    </section>
    <!--main content end-->
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script>
    var ctx_year = document.getElementById('year_chart').getContext('2d');
    var ctx_month = document.getElementById('month_chart').getContext('2d');

    var this_year = new Date().getFullYear();
    var this_month = new Date().getMonth() + 1;

    var costbill_data;
    var last_year_data;
    var cur_year_data;
    var last_year_take;
    var cur_year_take;

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    var csrftoken = getCookie('csrftoken');
    var xhr;

    window.onload = function() {
        xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
                if (xhr.status == 200) {
                    var data = xhr.responseText;
                    costbill_data = JSON.parse(data);

                    cal_val(costbill_data);

                    last_year_take="";

                    for(let i=0; i<3; i++) {
                        var each_data = costbill_data[i];
                        last_year_take += each_data['version_cd'];
                    }
                }
            } else {
                if (xhr.status == 400) {
                    var data = xhr.responseText;
                    var obj = JSON.parse(data);
                }
            }
        };

        var strurl = "http://127.0.0.1:8080/rest_api/costbill";
        xhr.open("GET", strurl, true);
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send(null);
    }

    function cal_val(data) {
        alert(data.length);
    }

    var year_chart = new Chart(ctx_year, {
        type: 'bar',
        data: {
            labels: ['제조원가', '매출액'],
            datasets: [{
                label: '성장률',
                type: 'line',
                yAxisID: 'y-axis-growth',
                fill: false,
                lineTension: 0,
                pointRadius: 0,
                backgroundColor: 'rgba(127, 127, 127, 0.5)',
                borderColor: 'rgba(127, 127, 127, 0.5)',
                data: [9, 5.7],
            }, {
                label: '전년',
                type: 'bar',
                yAxisID: 'y-axis-cost',
                backgroundColor: 'rgba(255, 127, 101, 0.4)',
                borderWidth: 1.5,
                hoverBorderWidth: 4,
                borderColor: 'rgba(255, 127, 101)',
                data: [70, 110]
            }, {
                label: '당년',
                type: 'bar',
                yAxisID: 'y-axis-cost',
                backgroundColor: 'rgba(101, 127, 255, 0.4)',
                borderWidth: 1.5,
                hoverBorderWidth: 4,
                borderColor: 'rgba(101, 127, 255)',
                data: [74, 110]
            }]
        },
        options: {
            responsive: false,
            legend: {
                labels: {
                    fontColor: '#000000'
                }
            },
            scales: {
                yAxes: [{
                    id: 'y-axis-cost',
                    type: 'linear',
                    position: 'left',
                    ticks: {
                        padding: 10,
                        fontColor: '#000000',
                        beginAtZero: true
                    },
                    gridLines: {
                        drawTicks: false,
                        color: '#000000',
                        lineWidth: 0.5,
                        zeroLineColor: '#000000',
                        zeroLineWidth: 0.5
                    }
                }, {
                    id: 'y-axis-growth',
                    type: 'linear',
                    position: 'right',
                    ticks: {
                        padding: 10,
                        fontColor: '#000000',
                        beginAtZero: true
                    },
                    gridLines: {
                        drawTicks: false,
                        display: false
                    }
                }],
                xAxes: [{
                    id: 'x-bottom',
                    position: 'bottom',
                    ticks: {
                        fontColor: '#000000',
                        padding: 10
                    },
                    gridLines: {
                        drawTicks: false,
                        color: 'transparent',
                        zeroLineWidth: 3,
                        zeroLineColor: '#808080'
                    }
                }, {
                    id: 'x-top',
                    position: 'top',
                    ticks: {
                        reverse: true,
                        display: false,
                        fontColor: '#000000'
                    },
                    gridLines: {
                        drawTicks: false,
                        color: 'transparent',
                        zeroLineWidth: 3,
                        zeroLineColor: '#FF0000'
                    }
                }]
            }
        }
    });

    var month_chart = new Chart(ctx_month, {
        type: 'bar',
        data: {
            labels: ['제조원가', '매출액'],
            datasets: [{
                type: 'line',
                label: '성장률',
                yAxisID: 'y-axis-growth',
                fill: false,
                lineTension: 0,
                backgroundColor: '#888888',
                borderColor: '#888888',
                borderRadius: 10,

                data: [3.7, 4.3]
            }, {
                label: '전월',
                yAxisID: 'y-axis-cost',
                backgroundColor: '#FFCC66',
                data: [6.7, 14],
                borderWidth: 0,
                hoverBorderWidth: 0
            }, {
                label: '당월',
                yAxisID: 'y-axis-cost',
                backgroundColor: '#66CCFF',
                data: [7.1, 15.5],
                borderWidth: 0,
                hoverBorderWidth: 0
            }]
        },

        options: {
            responsive: false,
            legend: {
                labels: {
                    fontColor: '#000000'
                }
            },
            scales: {
                yAxes: [{
                    id: 'y-axis-cost',
                    type: 'linear',
                    position: 'left',
                    ticks: {
                        fontColor: '#000000',
                        beginAtZero: true
                    }
                }, {
                    id: 'y-axis-growth',
                    type: 'linear',
                    position: 'right',
                    ticks: {
                        fontColor: '#000000',
                        beginAtZero: true
                    }
                }],
                xAxes: [{
                    ticks: {
                        fontColor: '#000000'
                    }
                }]
            }
        }
    });
</script>

{% endblock %}