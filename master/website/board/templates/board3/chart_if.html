{% extends "base.html" %}
{% load static %}

{% block scripts %}
{{ block.super }}
<script>

</script>
{% endblock %}

{% block body %}

{% include "navbar.html" %}
{% include "sidebar.html" %}

<!-- Styles -->
<style>
ul.tabs{
	margin: 0px;
	padding: 0px;
	list-style: none;
}

ul.tabs li{
  display: inline-block;
	background: #898989;
	color: white;
	padding: 10px 15px;
	cursor: pointer;
}

ul.tabs li.current{
	background: #e0e0e0;
	color: #222;
}

.tab-content {
    display: none;
    padding: 12px;
    width: 1100px;
}

.tab-content.current{
	display: inherit;
}
</style>

<!--main content start-->
<section id="main-content">
    <section class="wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="page-header"><i class="icon_piechart"></i> Chart</h3>
            </div>
        </div>
        <div class="row">
            <!-- chart morris start -->
            <div class="col-lg-12">
                <section class="panel">
                    <header class="panel-heading">
                        <h3>Chart 1</h3>
                    </header>
                    <div class="panel-body">
                        <div class="tab-pane" id="chartjs">
                            <div class="row">
                                <!-- Line -->
                                <div class="col-lg-6">
                                            <div class="container">
                                            <!-- 탭 메뉴 상단 시작 -->
                                                <ul class="tabs">
                                                    <li class="tab-link current" data-tab="tab-1">당기 투입</li>
                                                    <li class="tab-link" data-tab="tab-2">당기 사용</li>
                                                </ul>

                                                <div id="tab-1" class="tab-content current">
                                                    <canvas id="chart_injection" height="300" width="1000"></canvas>
                                                    <div class="table-responsive">
                                                        <table class="table" width="100%">
                                                            <tr>
                                                                <th></th>
                                                                <th>1월</th>
                                                                <th>2월</th>
                                                                <th>3월</th>
                                                                <th>4월</th>
                                                                <th>5월</th>
                                                                <th>6월</th>
                                                                <th>7월</th>
                                                                <th>8월</th>
                                                                <th>9월</th>
                                                                <th>10월</th>
                                                                <th>11월</th>
                                                                <th>12월</th>
                                                            </tr>
                                                            <tr>
                                                                <th>변동비</th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                            </tr>
                                                            <tr>
                                                                <th>고정비</th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                            </tr>
                                                            <tr>
                                                                <th>매출액</th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>

                                                <div id="tab-2" class="tab-content">
                                                    <canvas id="chart_usage" height="300" width="1000"></canvas>
                                                    <table class="table" width="100%">
                                                        <tr>
                                                            <th></th>
                                                            <th>1월</th>
                                                            <th>2월</th>
                                                            <th>3월</th>
                                                            <th>4월</th>
                                                            <th>5월</th>
                                                            <th>6월</th>
                                                            <th>7월</th>
                                                            <th>8월</th>
                                                            <th>9월</th>
                                                            <th>10월</th>
                                                            <th>11월</th>
                                                            <th>12월</th>
                                                        </tr>
                                                        <tr>
                                                            <th>재료비</th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                        </tr>
                                                        <tr>
                                                            <th>노무비</th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                        </tr>
                                                        <tr>
                                                            <th>경비</th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                        </tr>
                                                        <tr>
                                                            <th>매출액</th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                            <th></th>
                                                        </tr>
                                                    </table>
                                                </div>
                                            <!-- 탭 메뉴 내용 끝 -->
                                            </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            <!-- chart morris start -->
        </div>
    </section>
    <!--main content end-->
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

<script>
    var csrftoken = getCookie('csrftoken');
    var xhr;

    var inj_period=['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'];
    var fixed_cost=[120, 56, 56, 100, 110, 50, 110, 50, 60, 110, 86, 79];
    var variable_cost=[115, 55, 55, 95, 105, 50, 105, 50, 55, 105, 88, 81];
    var mater_cost=[120, 56, 56, 100, 110, 50, 110, 50, 60, 110, 86, 79];
    var labor_cost=[115, 55, 55, 95, 105, 50, 105, 50, 55, 105, 88, 81];
    var expense_cost=[90, 40, 40, 70, 80, 50, 80, 50, 55, 80, 90, 83];
    var sales_cost=[480, 400, 385, 420, 500, 530, 400, 450, 430, 430, 440, 460];

    var inj_canvas = document.getElementById('chart_injection').getContext('2d');
    var usa_canvas = document.getElementById('chart_usage').getContext('2d');

    $(document).ready(function() {
        $('ul.tabs li').click(function () {
            var tab_id = $(this).attr('data-tab');

            $('ul.tabs li').removeClass('current');
            $('.tab-content').removeClass('current');

            $(this).addClass('current');
            $("#" + tab_id).addClass('current');
        })
    });

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    window.onload = function() {
        xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
                if (xhr.status == 200) {
                    var data = xhr.responseText;
                    costbill_data = JSON.parse(data);

                    cal_val(costbill_data);

                    last_year_take="";

                    for(let i=0; i<3; i++) {
                        var each_data = costbill_data[i];
                        last_year_take += each_data['version_cd'];
                    }
                }
            } else {
                if (xhr.status == 400) {
                    var data = xhr.responseText;
                    var obj = JSON.parse(data);
                }
            }
        };

        var strurl = "http://127.0.0.1:8080/rest_api/costbill";
        xhr.open("GET", strurl, true);
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send(null);
    }

    function cal_val(data) {
        // 1번 아이템
        alert(Math.floor(data[1]['periodym_cd']/100));
        alert(data[1]['periodym_cd']%100);
        /*
        for (var i = 0; i < data.length; i++) {
            var cur_data = data[i];
            if(cur_data[''])
        }

         */
    }

    var inj_data= {
        labels: inj_period,
        datasets: [{
            label: '매출액',
            type: 'line',
            xAxisID: 'x_down',
            yAxisID: 'sales_line',
            fill: false,
            lineTension: 0,
            pointRadius: 0,
            borderColor: '#808080',
            hoverPointRadius: 5,
            data: sales_cost
        }, {
            label: '고정비',
            type: 'bar',
            xAxisID: 'x_down',
            yAxisID: 'cost_bar',
            backgroundColor: '#E38785',
            data: fixed_cost
        }, {
            label: '변동비',
            type: 'bar',
            xAxisID: 'x_down',
            yAxisID: 'cost_bar',
            backgroundColor: '#F49FEA',
            data: variable_cost
        }]
    };

    var inj_opt= {
        responsive: false,
        legend: {
            labels: {
                fontColor: '#000000'
            }
        },
        scales: {
            // y축
            yAxes: [{
                id: 'sales_line',
                name: 'A',
                type: 'linear',
                position: 'left',
                scalePositionLeft: true,
                stacked: true,
                scaleLabel: {
                    display: true,
                    labelString: '매출액(원)'
                },
                ticks: {
                    stepSize: 120,
                    fontColor: '#808080'
                }
            }, {
                id: 'cost_bar',
                name: 'B',
                type: 'linear',
                position: 'right',
                scalePositionLeft: true,
                stacked: true,
                ticks: {
                    fontColor: '#FF0000',
                    stepSize: 40
                },
                scaleLabel: {
                    display: true,
                    labelString: '당기 투입(원)'
                }
            }],
            xAxes: [{
                id: 'x_down',
                stacked: true,
                ticks: {
                    fontColor: '#000000',
                    fontStyle: 'bold',
                    padding: 10
                },
                scaleLabel: {
                    display: true,
                    labelString: '기간(월)'
                },
                gridLines: {
                    color: 'transparent',
                    drawTicks: false,
                    zeroLineColor: '#808080',
                    zeroLineWidth: 3
                }
            }, {
                // 이 x축은 우측 y축의 색상을 변경하기 위해 넣은 축 (기능 X)
                id: 'x_top',
                position: 'top',
                stacked: true,
                ticks: {
                    display: false,
                    reverse: true,
                    fontColor: '#000000',
                    fontStyle: 'bold'
                },
                gridLines: {
                    drawTicks: false,
                    color: 'transparent',
                    zeroLineColor: 'rgba(255, 0, 0, 0.6)',
                    zeroLineWidth: 3
                }
            }]
        }
    };

    var inj_chart = new Chart(inj_canvas, {
        type: 'bar',
        data: inj_data,
        options: inj_opt
    });

    var usa_chart = new Chart(usa_canvas, {
        type: 'bar',
        data: {
            labels: inj_period,
            datasets: [{
                label: '매출액',
                type: 'line',
                yAxisID: 'sales_line',
                fill: false,
                lineTension: 0,
                pointRadius: 1,
                borderColor: '#808080',
                borderWidth: 5,
                data: sales_cost
            }, {
                label: '재료비',
                type: 'bar',
                yAxisID: 'cost_bar',
                backgroundColor: 'rgba(0, 0, 255, 0.6)',
                data: mater_cost
            }, {
                label: '노무비',
                type: 'bar',
                yAxisID: 'cost_bar',
                backgroundColor: 'rgba(93, 119, 255, 0.4)',
                data: labor_cost
            }, {
                label: '경비',
                type: 'bar',
                yAxisID: 'cost_bar',
                backgroundColor: 'rgba(135, 175, 255, 0.4)',
                data: expense_cost
            }]
        },

        options: {
            responsive: false,
            legend: {
                labels: {
                    fontColor: '#000000'
                }
            },
            scales: {
                yAxes: [
                    {
                        id: 'sales_line',
                        name: 'A',
                        type: 'linear',
                        position: 'left',
                        display: true,
                        scalePositionLeft: true,
                        stacked: true,
                        ticks: {
                            fontColor: '#000000'
                        },
                        scaleLabel:{
                            display: true,
                            labelString: '매출액(원)'
                        }
                    }, {
                        id: 'cost_bar',
                        name: 'B',
                        type: 'linear',
                        position: 'right',
                        scalePositionLeft: true,
                        stacked: true,
                        ticks: {
                            fontColor: '#000000'
                        },
                        scaleLabel:{
                            display: true,
                            labelString: '매출액(원)'
                        },
                        gridLines: {
                            color: ['rgba(0, 0, 255, 0.6)', '#D9D9D9', '#D9D9D9', '#D9D9D9', '#D9D9D9', '#D9D9D9'],
                            lineWidth: [5, 1, 1, 1, 1, 1]
                        }
                    }],
                xAxes: [{
                    stacked: true,
                    ticks: {
                        fontColor: '#000000'
                    },
                    gridLines: {
                        zeroLineColor: '#808080',
                        zeroLineWidth: 3
                    },
                    scaleLabel: {
                        display: true,
                        labelString: '매출액(원)'
                    }
                }]
            }
        }
    });
</script>



{% endblock %}

